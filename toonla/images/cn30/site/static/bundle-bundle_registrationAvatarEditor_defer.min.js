new LightboxRecuperaDatosController("#lightboxUsuarioInexistente").init();new LightboxRecuperaDatosController("#lightboxRecuperaDatos").init();LightboxCreditsPopupController.init();var RegistrationAvatarEditorController={$social:null,initialized:false,embedID:"avatarEditor",base:null,avatarEditor:null,avatarEditorSWF:null,avatarEditorConfig:null,serviceURL:null,feed:null,avatarImageBase64:null,avatarDisplaySWForm:null,avatarTemp:null,avatarInput:null,_isRunningInsideMundoToonix:false,init:function(){this.$social=$("#registration_edit_avatar");this.serviceURL=this.$social.attr("data-service-url");this.avatarPartsList=this.$social.attr("data-avatar-parts-list");this.feed=CNConfig.feed;this.base=CNConfig.cdnPath+"static/swf/AvatarEditor/";this.avatarEditorSWF=this.base+"AvatarEditor.swf";this.avatarEditorConfig=this.base+"xml/avatarEditorConfig.xml";this.avatarDisplaySWForm=$("#avatarParts");this.overrideFunctions();if(!this._isRunningInsideMundoToonix){$(document).on("session.status",$.proxy(this.onSessionStatus,this))}else{this.show()}},show:function(){this.comeFromSocial();var flashvars={country:CNConfig.country,divId:this.embedID},params={allowFullScreen:"false",allowScriptAccess:"always",allownetworking:"all",wmode:"transparent"};swfobject.embedSWF(this.avatarEditorSWF,this.embedID,"100%","700","10.0.0",false,flashvars,params,{},$.proxy(this.onAvatarEditorLoad,this))},comeFromSocial:function(){if(LocalStorageController.get("avatarSocialTemp")!=null){this.saveSocialAvatar(LocalStorageController.get("avatarSocialTemp"));LocalStorageController.set("avatarSocialTemp",null)}},overrideFunctions:function(){CNLALibrary.buyAvatarAccessory=function(params,callback){callback({success:true,credits:10000})};CNLALibrary.getPurchasedAvatarAccessoryListByUser=function(params,callback){callback([])}},onAvatarEditorLoad:function(e){if(e.success){this.avatarEditor=e.ref}},onAppReady:function(){var user=CNSessionController.isUserLoggedIn(),initParams={},userInfo;if(user){userInfo=CNSessionController.getUserInfo();initParams.avatar=userInfo.avatar;initParams.user={id:userInfo.id,name:userInfo.userName,credits:CNHelpers.creditsFiller(userInfo.credits)}}initParams.cdnPath=this.base;initParams.configPath=this.avatarEditorConfig;this._getEmbededSwf().init(initParams)},initAvatarEditor:function(){var initParams={avatar:$.parseJSON(this.avatarListDTO),cdnPath:this.base,configPath:this.avatarEditorConfig};this.avatarEditor.init(initParams)},onBuyAccessory:function(accessoryId){console.log("onBuyAccessory("+accessoryId+")")},onShowCredits:function(){console.log("onShowCredits()")},onCancel:function(){if(this._isRunningInsideMundoToonix){MundoToonixController.onAvatarEditorCancel()}},onSave:function(avatar){this.saveSocialAvatar(avatar)},_getEmbededSwf:function(){return $("#avatarEditor")[0]},saveSocialAvatar:function(avatarListDTO){this.avatarTemp=$.parseJSON(avatarListDTO[0]);this.$avatarInput=avatarListDTO[0].replace(/\r?\n/g,"\r\n");this.avatarImageBase64="data:image/png;base64,"+this.avatarTemp.imageData;if(CNSessionController.isUserLoggedIn()){this.saveAvatarWhenUserLogin(avatarListDTO)}else{this.addDataValuesToContainer();this.showSecondStepForm()}},showSecondStepForm:function(){trackRegistrations("reg_step_1_create_avatar");$("#registration_edit_avatar").hide();$(".second-part-register").show()},saveAvatarWhenUserLogin:function(avatar){var ajaxOptions;var asyncParams;var newAvatar=avatar[0].replace(/\r?\n/g,"\r\n");ajaxOptions={type:"POST",url:this.serviceURL,data:"",success:$.proxy(this.onSaveSuccess,this)};asyncParams=$.param({avatar:newAvatar,userId:CNSessionController.getUserId(),username:CNSessionController.getUserName(),feed:this.feed});ajaxOptions.data=asyncParams;CNLAGames.notifyAction("Sys_EditAvatar");$.ajax(ajaxOptions)},addDataValuesToContainer:function(){var avatarDto=this.avatarTemp;this.avatarDisplaySWForm.attr("data-user-avatar-body",avatarDto.body);this.avatarDisplaySWForm.attr("data-user-avatar-bodyColor",avatarDto.bodyColor);this.avatarDisplaySWForm.attr("data-user-avatar-costume",avatarDto.costume);this.avatarDisplaySWForm.attr("data-user-avatar-eye",avatarDto.eye);this.avatarDisplaySWForm.attr("data-user-avatar-head",avatarDto.head);this.avatarDisplaySWForm.attr("data-user-avatar-headColor",avatarDto.headColor);this.avatarDisplaySWForm.attr("data-user-avatar-mouth",avatarDto.mouth);this.avatarDisplaySWForm.attr("data-user-avatar-skinColor",avatarDto.skinColor);this.registrationControllerInit()},registrationControllerInit:function(){RegistrationController.init();RegistrationController.$avatar=this.$avatarInput;$(document).scrollTop(0)},onSaveSuccess:function(response){if(this._isRunningInsideMundoToonix){MundoToonixController.onAvatarEditorSaveSuccess();return}if(CNSessionController.isUserLoggedIn()){this.updateAvatarUserOnLocalStorage(response);LightboxController.init("lightboxPreferenciasGuardadas",{close:[".cerrar-btn"]});LightboxController.open("lightboxPreferenciasGuardadas");this.changeImgOnEditAvatar();return}$("#contenido").html(response);RegistrationController.init();$(document).scrollTop(0)},updateAvatarUserOnLocalStorage:function(avatar){this.assignNewValuesToUserData(avatar)},assignNewValuesToUserData:function(avatar){CNSessionController.assignNewValuesToUserData(avatar,this.avatarImageBase64)},changeImgOnEditAvatar:function(){if(CNHelpers.validateSupportBase64()){$("#navbar_logueado_form .img_avatar img").attr("src",this.avatarImageBase64)}},onSessionStatus:function(e,session){if(!this.initialized){this.initialized=true;this.show()}},setRunningInsideMundoToonix:function(insideMundoToonix){this._isRunningInsideMundoToonix=insideMundoToonix}};function onAppReady(){return RegistrationAvatarEditorController.onAppReady()}function onBuyAccessory(accessoryId){return RegistrationAvatarEditorController.onBuyAccessory(accessoryId)}function onShowCredits(){return RegistrationAvatarEditorController.onShowCredits()}function onCancel(){return RegistrationAvatarEditorController.onCancel()}function onSave(avatar){return RegistrationAvatarEditorController.onSave(avatar)}var RegistrandoToonixController={PROGRESS_BAR_DURATION:10,animate:function(animationFinishCallback){$("#registrandoToonix .progress-bar .progress").animate({width:"100%"},this.PROGRESS_BAR_DURATION*1000,animationFinishCallback);$("#registrandoToonix .notice-info").animate({top:"0px"},300,"linear").effect("bounce",400);$("#registrandoToonix .notice-cyberbullying").delay(1400).animate({top:"0px"},300,"linear").effect("bounce",400);$("#registrandoToonix .notice-cheat").delay(2900).animate({top:"0px"},300,"linear").effect("bounce",400)}};RegistrationAvatarEditorController.init();new LightboxRecuperaDatosController("#lightboxUsuarioInexistente").init();new LightboxRecuperaDatosController("#lightboxRecuperaDatos").init();LightboxCreditsPopupController.init();